\chapter{spikes}
\label{sec:attract_mode}
\lhead[tempest]{}
\lstset{style=6502Style}

A standard tanker in \textit{Tempest} releases flippers when it is struck.

\begin{minipage}[c]{0.48\linewidth}
\vspace{-0.6cm}
\begin{figure}[H]
    \centering
    \begin{adjustbox}{width=6.5cm,center}
      \includegraphics{src/spikes/spike_evolution_blank.png}%
    \end{adjustbox}
\end{figure}
\end{minipage}
\begin{minipage}[c]{0.06\linewidth}
\begin{figure}[H]
    \centering
    \begin{tikzpicture}[baseline={(current bounding box.south)}]
      \draw[->,line width=3pt] (0,0) to (1,0);
    \end{tikzpicture}
\end{figure}
\end{minipage}
\begin{minipage}[c]{0.48\linewidth}
\vspace{-0.6cm}
\begin{figure}[H]
    \centering
    \begin{adjustbox}{width=6.5cm,center}
      \includegraphics{src/spikes/spike_evolution_spike_only.png}%
    \end{adjustbox}
\end{figure}
\end{minipage}

\begin{minipage}[c]{0.48\linewidth}
\vspace{-0.6cm}
\begin{figure}[H]
    \centering
    \begin{adjustbox}{width=6.5cm,center}
      \includegraphics{src/spikes/spike_evolution_spike_only.png}%
    \end{adjustbox}
\end{figure}
\end{minipage}
\begin{minipage}[c]{0.06\linewidth}
\begin{figure}[H]
    \centering
    \begin{tikzpicture}[baseline={(current bounding box.south)}]
      \draw[->,line width=3pt] (0,0) to (1,0);
    \end{tikzpicture}
\end{figure}
\end{minipage}
\begin{minipage}[c]{0.48\linewidth}
\vspace{-0.6cm}
\begin{figure}[H]
    \centering
    \begin{adjustbox}{width=6.5cm,center}
      \includegraphics{src/spikes/spike_evolution_1.png}%
    \end{adjustbox}
\end{figure}
\end{minipage}

\begin{minipage}[c]{0.48\linewidth}
\vspace{-0.6cm}
\begin{figure}[H]
    \centering
    \begin{adjustbox}{width=6.5cm,center}
      \includegraphics{src/spikes/spike_evolution_1.png}%
    \end{adjustbox}
\end{figure}
\end{minipage}
\begin{minipage}[c]{0.06\linewidth}
\begin{figure}[H]
    \centering
    \begin{tikzpicture}[baseline={(current bounding box.south)}]
      \draw[->,line width=3pt] (0,0) to (1,0);
    \end{tikzpicture}
\end{figure}
\end{minipage}
\begin{minipage}[c]{0.48\linewidth}
\vspace{-0.6cm}
\begin{figure}[H]
    \centering
    \begin{adjustbox}{width=6.5cm,center}
      \includegraphics{src/spikes/spike_evolution_2.png}%
    \end{adjustbox}
\end{figure}
\end{minipage}

\begin{minipage}[c]{0.48\linewidth}
\vspace{-0.6cm}
\begin{figure}[H]
    \centering
    \begin{adjustbox}{width=6.5cm,center}
      \includegraphics{src/spikes/spike_shooting_1.png}%
    \end{adjustbox}
\end{figure}
\end{minipage}
\begin{minipage}[c]{0.06\linewidth}
\begin{figure}[H]
    \centering
    \begin{tikzpicture}[baseline={(current bounding box.south)}]
      \draw[->,line width=3pt] (0,0) to (1,0);
    \end{tikzpicture}
\end{figure}
\end{minipage}
\begin{minipage}[c]{0.48\linewidth}
\vspace{-0.6cm}
\begin{figure}[H]
    \centering
    \begin{adjustbox}{width=6.5cm,center}
      \includegraphics{src/spikes/spike_shooting_2.png}%
    \end{adjustbox}
\end{figure}
\end{minipage}

\begin{lstlisting}
        .SBTTL  DISPLAY - ENEMY LINES

DSPENL:
        LDA LEVELY+1            ;BOTTOM OF WELL
        IFNE                    ;WELL ON?
        RTS                     ;NO. NO ENEMY LINES THEN
        ENDIF
        LDA EYH
        IFEQ                    ;EYE ON WELL?
        LDA EYL                 ;YES.
        CMP I,0F0
        IFCS                    ;PAST END?
        RTS                     ;YES. ABORT
        ENDIF
        ENDIF
        LDA I,1
        JSR VGSCA1
        LDA VGLIST              ;SAVE FOR NEXT TIME
        PHA
        LDA VGLIST+1
        PHA
        LDA I,0                 ;LINE LOOP INDEX
        STA INDEX2
        STA VGY
        LDX I,NLINES-1
        LDA WELTYP
        IFNE                    ;PLANAR?
        DEX                     ;YES. 1 LESS LINE
        ENDIF
        STX INDEX1
        BEGIN                   ;LOOP FOR EACH LINE FROM 0 TO TOP
        LDX I,3
        LDY VGY                 
        BEGIN                   ;SET FIXED CODES
        LDA X,ENLFIX            ;(CSTATGREEN,CNTR)
        STA NY,VGLIST
        INY
        DEX
        MIEND
        STY VGY
        LDA ROTDIS
        IFEQ                    ;REDO WELL?
        LDX INDEX2              ;NO
        LDA X,LINSTA
        IFPL                    ;ACTION AT NEAR PT?
        LDX I,0B
        LDY VGY
        BEGIN                   ;NO. COPY VARIABLE STUFF
        LDA NY,OLDLLO           ;COPY VECTOR TO FAR POINT AND
        STA NY,VGLIST           ;VECTOR TO NEAR POINT
        INY
        DEX
        MIEND
        STY VGY
        ELSE
        LDY VGY                 ;NO. SINCE FAR PT. NEED NOT BE
        LDA NY,OLDLLO           ;RECALCULATED, COPY IT TO NEW BUFFER.
        STA NY,VGLIST           ;
        STA CURNTY                      ;Z VECTOR (LSB)
        INY
        LDA NY,OLDLLO
        STA NY,VGLIST
        CMP I,10
        IFCS
        ORA I,0E0               ;SIGN EXTEND
        ENDIF
        STA CURNTY+1                    ;Z VECTOR (MSB)
        INY
        LDA NY,OLDLLO
        STA NY,VGLIST           ;X VECTOR (LSB)
        STA CURNTX
        INY
        LDA NY,OLDLLO
        STA NY,VGLIST           ;
        CMP I,10
        IFCS
        ORA I,0E0               ;SIGN EXTEND
        ENDIF
        STA CURNTX+1                    ;X VECTOR (MSB)
        INY
        STY VGY
        JSR TIPACT              ;YES. GENERATE TIP STUFF
        ENDIF
        ELSE
                                ;YES (REDO WELL)
        JSR FIXSTU              ;GENERATE FIXED STUFF
        JSR TIPACT              ;GENERATE TIP STUFF
        ENDIF
        LDX INDEX2
        ASL X,LINSTA            ;CLEAR LINE STATUS
        INC INDEX2
        DEC INDEX1
        MIEND
        PLA                     ;SAVE LOC OF NEW BUFFER
        STA OLDLHI
        PLA
        STA OLDLLO
        LDY VGY
        DEY
        JMP VGADD               ;UPDATE VGLIST
\end{lstlisting}
\begin{lstlisting}
        .SBTTL  DISPLAY - ENEMY LINES (INITIAL FIXED VG CODES)
                                ;
                                ;PLACES COLOR STAT
                                ;             CNTR
                                ;             VCTR TO FAR PT.
                                ;INTO VGLIST(VGY)
ENLFIX: .BYTE 80,40,68,05
FIXSTU:
                                ;CALCULATE SCREEN LOCATION OF
                                ;FAR POINT
        LDA INDEX2
        TAX
        CLC                     ;AVERAGING SCREEN COORDNATE
        ADC I,1                 ;OF ADJACENT LINES
        AND I,0F
        TAY
        LDA X,LIFSXL
        SEC                     ;ROUND
        ADC Y,LIFSXL
        STA SXL
        LDA X,LIFSXH
        ADC Y,LIFSXH
        STA SXH
        ASL
        ROR SXH
        ROR SXL
        LDA X,LIFSZL
        SEC                     ;ROUND
        ADC Y,LIFSZL
        STA SZL
        LDA X,LIFSZH
        ADC Y,LIFSZH
        STA SZH
        ASL
        ROR SZH
        ROR SZL
                                ;FALL INTO YVGVCT
        .SBTTL  UTILITY - QUICK BLANK VECTOR FROM SX,SZ
;UPDATES CURNTX(2) AND CURNTY(2) WITH SXL(2) AND SZL(2).
;UPDATES VGY
YVGVCT: LDY VGY
        LDA SZL
        STA NY,VGLIST
        INY
        STA CURNTY
        LDA SZH
        STA CURNTY+1
        AND I,1F
        STA NY,VGLIST
        INY
        LDA SXL
        STA NY,VGLIST
        INY
        STA CURNTX
        LDA SXH
        STA CURNTX+1
        AND I,1F
        STA NY,VGLIST
        INY
        STY VGY
        RTS
        .SBTTL  DISPLAY - ENEMY LINES (TIP STUFF)
                                ;
                                ;PLACES VECTOR TO NEAR PT AND
                                ;(DOT STAT COLOR, JSRL DOT) OR
                                ;(SHATTER SCAL, SHATTER JSRL PIC)
                                ;INTO VGLIST (VGY)
TIPACT:                         ;OR IF INACTIVE, 4 SCAL 1,05
        LDX INDEX2
        LDA X,LINEY
        IFEQ                    ;LINE ACTIVE?
        LDY VGY                 ;NO. FILL WITH SCAL 1,0
        LDX I,03
        BEGIN                   ;LOOP TO FILL 8 BYTES
        LDA I,0                 ;SCAL 1,0 LSB (NOOP)
        STA NY,VGLIST
        INY
        LDA I,71                ;SCAL 1,0 MSB (NOOP)
        STA NY,VGLIST
        INY
        DEX
        MIEND
        STY VGY
        ELSE
        STA PYL                 ;LINE IS ACTIVE
                                ;CALCULATE NEAR PT.
        JSR CHKDEP              ;YES, CHECK EYE
        LDA X,LINEXM            ;X COORD OF MIDWAY PT.
        STA PXL
        LDA X,LINEZM            ;Z COORD OF MIDWAY PT.
        STA PZL
        JSR WORSCR              ;PROJECT ENEMY LIVE NEAR PT.
                                ;SAVE NEW COORDINATES
        JSR FCONNEC             ;DRAW VECTOR TO NEAR PT.
        LDX INDEX2
        LDA X,LINSTA
        AND I,40
        IFNE                    ;WHAT'S HAPPENING AT TIP?
        JSR CASCAL              ;SHATTERED
                                ;SET PROJECTION SCALE
        LDA RANDOM
        AND I,2
        CLC
        ADC I,PTSPAR
        TAX                     ;DETERMINE SHATTER PIC
        LDA X,PICHI
        INY                     ;INSERT JSRL TO SHATTER PIC
        STA NY,VGLIST
        DEY
        LDA X,PICLO
        STA NY,VGLIST
        INY
        INY
        STY VGY
        ELSE
WHITIP: LDY VGY                 ;JUST A DOT AT TIP
        LDA I,WHITE             ;COLOR (SET STAT WHITE)
        STA NY,VGLIST
        INY
        LDA I,68
        STA NY,VGLIST
        INY
        LDA JSRDOT              ;INSERT JSRL TO DOT
        STA NY,VGLIST
        INY
        LDA JSRDT1
        STA NY,VGLIST
        INY
        STY VGY
        ENDIF
        ENDIF
        RTS
\end{lstlisting}

\begin{lstlisting}
        .SBTTL  PLAY - INVADERS -TRAILER
                                ;
                                ;SPECIAL TRAILER PROCESSING
                                ;
JSTRAI:
        LDA I,1
        STA CAMSTA
        LDY X,INVAL1
        LDA Y,LINEY
        IFEQ                    ;LINE VACANT?
        LDA I,ILINDDY+1         ;YES. START LOW. 2
        STA Y,LINEY
        ENDIF
        LDA X,INVAY
        CMP Y,LINEY
        IFCC                    ;NEW ENEMY LINE?
        STA Y,LINEY             ;YES.
        LDA I,80
        STA Y,LINSTA            ;REQUEST RECALC.
                                ;NO DESTRUCTION PICS
        ENDIF
        LDA X,INVAY
        CMP I,20
        IFCC                    ;MAX HEIGHT?
        LDA X,INVAC2            ;YES.
        ORA I,ZDIRDO            ;SEND IT DOWN
        STA X,INVAC2
        LDA I,20                ;MAX HEIGHT
        STA X,INVAY
        ELSE
        CMP I,0F2               ;NO.
        IFCS                    ;MIN HEIGHT?
        JSR ASTRAL              ;YES. REASSIGN, REVERSE
        LDA I,0F0               ;DON'T LET IT GET TO LOW
        STA X,INVAY
        LDA NYMCOU              ;ANY NYMPHS, OR NON SPIKER TYPE CLIMBERS?
        IFEQ
        LDA X,INVAC2
        AND I,^C<INVCAR>        ;CONVERT IT TO TANKER
        ORA I,ZCARFL            ;CARRYING FLIPPERS
        STA X,INVAC2
        LDA X,INVAC1            ;LOOKS LIKE TANKER TOO
        AND I,^C<INVABI>
        ORA I,ZABTAN
        STA X,INVAC1
        LDA I,0                 ;SET ZERO STATUS (CONVERTED TOO CARRIER)
        STA CAMSTA
        ENDIF
        ENDIF
        ENDIF
        RTS
\end{lstlisting}

\begin{lstlisting}
ASTRAL:
        LDA I,0
        STA TEMP4
        LDA I,NLINES-1          ;LOOP LINE COUNTER
        STA OPSPIN

        LDA RANDO2              ;START AT A RANDOM LINE
        AND I,0F
        TAY
        BEGIN                   ;LOOP FOR EACH LINE
        CPY I,0F
        IFEQ
        LDA WELTYP
        BNE SKIPIT              ;SKIP LINE IF PLANAR FAR RIGHT EDGE
        ENDIF
        LDA Y,LINEY
        IFEQ                    ;DEAD LINE?
        LDA I,0FF               ;YES. WORST CASE
        ENDIF
        CMP TEMP4
        IFCS                    ;NEEDIEST LINE SO FAR?
        STA TEMP4               ;YES. CONDITION
        STY TEMP0               ;LINE #
        ENDIF
SKIPIT: DEY
        IFMI
        LDY I,NLINES-1
        ENDIF
        DEC OPSPIN
        MIEND
        LDA TEMP0               ;REASSIGN TO NEW LINE
        STA X,INVAL1
        CLC
        ADC I,1
        AND I,0F
        STA X,INVAL2
        LDA X,INVAC2            ;SEND BACK UP
        AND I,^C<INVDIR>
        STA X,INVAC2
        RTS
\end{lstlisting}
